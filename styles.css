:root{
      --bg: #0b1533;
      --ink: #eaf0ff;

      /* JS asettaa --vh */
      --vh: 1vh;

      /* safe area */
      --sat: env(safe-area-inset-top);
      --sar: env(safe-area-inset-right);
      --sab: env(safe-area-inset-bottom);
      --sal: env(safe-area-inset-left);

      /* game sizing */
      --cell: 56px;
      --gap: 8px;
      --boardPad: 10px;

      /* dots */
      --dotScale: 1.30;
      --dotBorder: 2px;

      --good: #49e2a8;
      --bad:  #ff5a6a;
      --warn: #ffd35a;
    }

    /* TÄRKEÄ: html-tausta estää valkoiset “nauhat” kuminauhassa */
    html{
      height: 100%;
      background: var(--bg);
      background-color: var(--bg);
    }

    body{
      margin:0;
      height: 100%;
      min-height: calc(var(--vh) * 100);
      background: var(--bg);
      color: var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: transparent;
	  background-repeat: no-repeat;
      background-size: cover;
      overflow: hidden;
      overscroll-behavior: none;
      user-select:none;
	    -webkit-user-select: none;
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
	    display: flex;
  flex-direction: column;
    }

    /* App-container hoitaa safe-areat (ei body!) */
#app{
  min-height: 100dvh;
  height: 100dvh;

  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
      background: radial-gradient(1200px 800px at 30% 10%, #162a67 0%, var(--bg) 55%, #070c1d 100%);
  padding-left: env(safe-area-inset-left);



  /* LISÄÄ NÄMÄ: */
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 10px;
}
*, *::before, *::after { box-sizing: border-box; }

#app > footer{
  padding-bottom: max(10px, env(safe-area-inset-bottom));
}

html, body{ background-attachment: scroll; }


/* Fallback jos 100dvh ei toimi jossain */
@supports not (height: 100dvh){
  #app{
    height: calc(var(--vh, 1vh) * 100);
    min-height: calc(var(--vh, 1vh) * 100);
  }
}

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-width:0;
    }

    .title{
      display:flex;
      gap:10px;
      align-items:baseline;
      min-width:0;
    }
    .title h1{ margin:0; font-size:22px; white-space:nowrap; }
    .title .sub{ font-size:12px; opacity:.85; font-weight:900; }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button, select{ font: inherit; color: var(--ink); }

    button{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.20);
      border-radius: 10px;
      padding: 8px 10px;
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.45; cursor:default; transform:none; }

    select{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 10px;
      padding: 8px 10px;
      font-weight: 900;
      outline:none;
      min-width: 240px;
      max-width: min(56vw, 420px);
    }

    main{
      min-height: 0;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    #game{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    #board{
      position: relative;
      width: calc(var(--cell) * 8 + var(--gap) * 7 + var(--boardPad) * 2);
      height: calc(var(--cell) * 8 + var(--gap) * 7 + var(--boardPad) * 2);
      border-radius: 18px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 40px rgba(0,0,0,.28);
      padding: var(--boardPad);
      touch-action: none;
      user-select:none;
    }

    #exitTag{
      position:absolute;
      /* EXIT on ruudulla A1 (0,0) */
      left: var(--boardPad);
      top: var(--boardPad);
      width: var(--cell);
      height: var(--cell);
      /* Keskitä teksti flex-boxilla */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 1000;
      opacity:.9;
      border-radius: 999px;
      background: rgba(73,226,168,.15);
      border: 1px solid rgba(73,226,168,.35);
      pointer-events:none;
      text-align: center;
    }

    #grid{
      position:absolute;
      inset: var(--boardPad);
      display:grid;
      grid-template-columns: repeat(8, var(--cell));
      grid-template-rows: repeat(8, var(--cell));
      gap: var(--gap);
    }

    .cell{
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.06);
      opacity:.55;
      position:relative;
    }
    .cell.playable{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.22);
      opacity: 1;
      cursor:pointer;
    }
    .cell.off{
      background: rgba(0,0,0,.34);
      border: 1px solid rgba(255,255,255,.05);
      opacity: .45;
    }
    .cell.exit{
      outline: 7px solid rgba(73,226,168,.45);
      outline-offset: -1px;
    }

    .hint{
      position:absolute;
      inset: 18%;
      border-radius: 999px;
      border: 3px solid rgba(255,255,255,.78);
      box-shadow: 0 0 0 2px rgba(0,0,0,.18) inset;
      pointer-events:none;
      opacity:.95;
    }

    .dot{
      position:absolute;
      width: calc(var(--cell) * var(--dotScale));
      height: calc(var(--cell) * var(--dotScale));
      border-radius: 999px;
      box-sizing:border-box;
      border: var(--dotBorder) solid rgba(255,255,255,.35);
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
    }

	.pieceDot{
	cursor:pointer; 
    touch-action: none;
    -webkit-user-select: none;
     user-select: none;
     will-change: transform;
    }

    .pieceDot.selected{
      outline: 3px solid rgba(255,255,255,.90);
      outline-offset: 2px;
    }
    .pieceDot.grouped{
     outline: 3px solid rgba(255,255,255,.90);
     outline-offset: 2px;
    }

    .pieceDot.dragging{
      opacity: 0.8;
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
    }
    .blockDot{
      border: var(--dotBorder) solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.92);
      cursor: default;
      pointer-events:none;
    }

    footer{ text-align:center; opacity:.95; font-weight:900; }
    footer.ok{ color: var(--good); }
    footer.bad{ color: var(--bad); }
    footer.warn{ color: var(--warn); }

/* iPhone portrait */
@media (max-width: 430px) and (orientation: portrait) and (hover:none) and (pointer:coarse){

  #app{
    gap: 8px;
    padding-top: max(10px, var(--sat));
    padding-left: 10px;
    padding-right: 10px;
    padding-bottom: 0; /* footer hoitaa safe-arean */
  }

  .title h1{ font-size: 20px; }

  select{ min-width: 100px; padding: 7px 9px; }
  button{ padding: 7px 9px; }

  /* Estä iOS:n 100vw + safe-area -leikkaus */
  #game{
    width: 100%;
    max-width: 100%;
    overflow: hidden;
  }

  /* Board ei saa koskaan ylittää parenttia */
  #board{
    max-width: 100%;
  }

  /* Header kahteen riviin */
  header{
    flex-direction: column;
    align-items: stretch;
    gap: 6px;
  }

  .title{
    justify-content: center;
  }

  .title h1{
    font-size: 24px;
    text-align: center;
  }

  .controls{
    justify-content: space-between;
    flex-wrap: nowrap;
    gap: 6px;
  }
    #exitTag{

      font-size: 14px;

    }
  #puzzleSelect{
    min-width: 0;
    max-width: 46vw;
    font-size: 13px;
    padding: 6px 8px;
    font-weight: 700;
  }

  #btnPrev, #btnNext{
    padding: 6px 8px;
    font-size: 14px;
  }

  #btnReset, #btnHelp{
    padding: 6px 8px;
    font-size: 12px;
    font-weight: 700;
    opacity: 0.85;
  }
}
